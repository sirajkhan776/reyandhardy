{% extends "base.html" %}
{% load static %}
{% load socialaccount %}
{% load widget_tweaks %}
{% block content %}
  <div class="row justify-content-center">
    <div class="col-md-6 col-lg-5">
      <div class="card shadow auth-card">
        <div class="card-body p-4">
          <div class="text-center mb-3">
            <img src="{% static BRAND_LOGO %}" alt="{{ STORE_NAME }}" height="44" class="logo-img mb-2" onerror="this.style.display='none'" />
            <h3 class="mb-0">Sign in</h3>
            <div class="text-muted small">{{ BRAND_TAGLINE }}</div>
          </div>
          <form method="post" action="{% url 'account_login' %}">
            {% csrf_token %}
            {% if redirect_field_value %}
              <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}" />
            {% endif %}
            {{ form.non_field_errors }}
            {% for field in form %}
              {% if field.field.widget.input_type == 'checkbox' %}
                <div class="mb-3 form-check form-switch">
                  {% render_field field class+="form-check-input" id="id_{{ field.name }}" %}
                  <label class="form-check-label" for="id_{{ field.name }}">{{ field.label }}</label>
                  {% if field.errors %}<div class="text-danger small">{{ field.errors|striptags }}</div>{% endif %}
                </div>
              {% elif field.field.widget.input_type == 'password' %}
                <div class="mb-3">
                  <label class="form-label" for="id_{{ field.name }}">{{ field.label }}</label>
                  <div class="input-group">
                    {% render_field field class+="form-control" %}
                    <button type="button" class="btn btn-outline-secondary toggle-password" data-target="id_{{ field.name }}" aria-label="Show password" onclick="if(window.togglePwd){togglePwd(this);} return false;"><i class="bi bi-eye"></i></button>
                  </div>
                  {% if field.errors %}<div class="text-danger small">{{ field.errors|striptags }}</div>{% endif %}
                </div>
              {% else %}
                <div class="mb-3">
                  <label class="form-label" for="id_{{ field.name }}">{{ field.label }}</label>
                  {% render_field field class+="form-control" %}
                  {% if field.errors %}<div class="text-danger small">{{ field.errors|striptags }}</div>{% endif %}
                </div>
              {% endif %}
            {% endfor %}
            <div class="d-grid">
              <button class="btn btn-gradient" type="submit">Sign in</button>
            </div>
          </form>
          <div class="d-grid mt-3">
            {% providers_media_js %}
            {% if socialaccount_providers %}
              <a class="btn btn-outline-dark" href="{% if redirect_field_value %}{% provider_login_url 'google' next=redirect_field_value %}{% else %}{% provider_login_url 'google' %}{% endif %}">Continue with Google</a>
            {% endif %}
          </div>
          <div class="mt-3 small">
            <a href="{% url 'account_reset_password' %}">Forgot password?</a>
          </div>
          <div class="mt-2 small">New here? <a href="{% url 'account_signup' %}">Create an account</a></div>
      </div>
    </div>
  </div>
</div>
{% block scripts %}
<script src="{% static 'js/password_toggle.js' %}"></script>
<script>
  function togglePwd(btn){
    var id = btn.getAttribute('data-target');
    var input = id ? document.getElementById(id) : null;
    if(!input){ var g = btn.closest('.input-group'); if(g) input = g.querySelector('input'); }
    if(!input) return false;
    if(input.type === 'password'){
      input.type = 'text';
      var icon = btn.querySelector('i'); if(icon){ icon.classList.remove('bi-eye'); icon.classList.add('bi-eye-slash'); }
      btn.setAttribute('aria-label','Hide password');
    } else {
      input.type = 'password';
      var icon2 = btn.querySelector('i'); if(icon2){ icon2.classList.remove('bi-eye-slash'); icon2.classList.add('bi-eye'); }
      btn.setAttribute('aria-label','Show password');
    }
    return false;
  }
</script>
{% endblock %}
{% endblock %}
