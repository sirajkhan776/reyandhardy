{% for u in users %}
  <tr class="clickable-user-row" onclick="location.href='/dashboard/users/{{ u.id }}/'" style="cursor:pointer;">
    <td data-label="Username">
      {% if u.profile and u.profile.avatar %}
        <img src="{{ u.profile.avatar.url }}" alt="avatar" width="28" height="28" style="object-fit:cover;border-radius:999px;" class="me-2 d-inline-block align-middle" />
      {% else %}
        <span class="avatar-circle me-2 d-inline-flex align-items-center justify-content-center">{{ u.username|slice:":1"|upper }}</span>
      {% endif %}
      <span class="align-middle">{{ u.username }}</span>
      <i class="bi bi-chevron-right ms-2 text-muted d-none d-sm-inline"></i>
    </td>
    <td class="d-none d-sm-table-cell" data-label="Email">{{ u.email|default:'-' }}</td>
    <td data-label="Staff">{% if u.is_staff %}<span class="badge bg-success">Yes</span>{% else %}<span class="badge bg-secondary">No</span>{% endif %}</td>
    <td data-label="Active">{% if u.is_active %}<span class="badge bg-success">Active</span>{% else %}<span class="badge bg-secondary">Inactive</span>{% endif %}</td>
    <td class="d-none d-sm-table-cell" data-label="Joined">{{ u.date_joined|date:"Y-m-d H:i" }}</td>
    <td class="text-end" data-label="Actions">
      <form method="post" action="/dashboard/users/{{ u.id }}/staff/" class="d-inline user-toggle-form" data-kind="staff">
        {% csrf_token %}
        <button type="submit" class="btn btn-sm {% if u.is_staff %}btn-outline-warning{% else %}btn-outline-primary{% endif %}">{% if u.is_staff %}Remove staff{% else %}Make staff{% endif %}</button>
      </form>
      <form method="post" action="/dashboard/users/{{ u.id }}/active/" class="d-inline user-toggle-form" data-kind="active">
        {% csrf_token %}
        <button type="submit" class="btn btn-sm {% if u.is_active %}btn-outline-danger{% else %}btn-outline-success{% endif %}">{% if u.is_active %}Deactivate{% else %}Activate{% endif %}</button>
      </form>
    </td>
  </tr>
{% empty %}
  <tr><td colspan="6" class="text-muted">No users found.</td></tr>
{% endfor %}
