{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{{ STORE_NAME }} — {{ BRAND_TAGLINE }}</title>
  <!-- Base Bootstrap first (fallback if theme CDN fails) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
  <!-- Theme bootstrap: dark + light variants toggled via JS -->
  <link id="bootswatchDark" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.3/dist/darkly/bootstrap.min.css" />
  <link id="bootswatchLight" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.3/dist/lux/bootstrap.min.css" disabled />
  <script>
    // Disable/enable theme stylesheets early to avoid FOUC (default to light)
    (function(){
      try {
        var th = localStorage.getItem('theme') || 'light';
        var dk = document.getElementById('bootswatchDark');
        var lt = document.getElementById('bootswatchLight');
        if (th === 'light') { if (dk) dk.disabled = true; if (lt) lt.disabled = false; }
        else { if (dk) dk.disabled = false; if (lt) lt.disabled = true; }
      } catch(e) {}
    })();
  </script>
  <!-- Bootstrap Icons for bottom nav -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />
  <!-- Google Fonts (Inter + Playfair Display) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Playfair+Display:wght@500;600;700;800&display=swap" rel="stylesheet">
  <!-- Local theme overrides -->
  <link rel="stylesheet" href="{% static 'css/theme.css' %}">
  {% if BRAND_GOLD or BRAND_GOLD_DARK %}
  <style>
    :root{
      {% if BRAND_GOLD %}--rh-gold: {{ BRAND_GOLD }};{% endif %}
      {% if BRAND_GOLD_DARK %}--rh-gold-dark: {{ BRAND_GOLD_DARK }};{% endif %}
    }
  </style>
  {% endif %}
  <script>
    // Initialize theme early to avoid flashes (default to light)
    (function(){
      try {
        var th = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', th);
      } catch(e) {}
    })();
  </script>
  {% block head %}{% endblock %}
  </head>
<body>
  {% include "partials/navbar.html" %}
  {% include "partials/mobile_header.html" %}
  {% block hero %}{% endblock %}
  <!-- Chip messages (toast-like) -->
  <div id="chip-messages" class="chip-container">
    {% for message in messages %}
      <div class="chip-msg chip-{{ message.tags }}" role="status" aria-live="polite">
        <span class="chip-dot"></span>
        <span class="chip-text">{{ message }}</span>
        <button class="chip-close" aria-label="Close">&times;</button>
      </div>
    {% endfor %}
  </div>
  <main class="container py-4">
    {% block content %}{% endblock %}
  </main>
  {% include "partials/footer.html" %}
  {% include "partials/bottom_nav.html" %}
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{% static 'js/theme.js' %}"></script>
  {% block scripts %}{% endblock %}
  <!-- Global submit overlay (loader) -->
  <div id="globalSubmitOverlay" class="submit-overlay d-none" aria-hidden="true">
    <div class="submit-box">
      <div class="spinner-border me-2" role="status" aria-label="Submitting..."></div>
      <div>
        <div class="fw-semibold">Please wait…</div>
        <div class="small text-muted">Processing your request</div>
      </div>
    </div>
  </div>
  <script>
    (function(){
      var overlay = document.getElementById('globalSubmitOverlay');
      function showOverlay(){ if(overlay) overlay.classList.remove('d-none'); }
      // Show on POST forms (avoid GET like search). Allow opt-out via data-no-overlay
      document.addEventListener('submit', function(ev){
        try {
          var form = ev.target;
          if (!form || form.tagName !== 'FORM') return;
          var method = (form.getAttribute('method') || 'GET').toUpperCase();
          if (form.hasAttribute('data-no-overlay')) return;
          if (method === 'POST') {
            showOverlay();
            // Prevent double submit
            form.querySelectorAll('button, input[type="submit"]').forEach(function(el){ el.disabled = true; });
          }
        } catch(e) {}
      }, true);
    })();
  </script>
</body>
</html>
